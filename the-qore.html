<!DOCTYPE html>
<html lang="en">
<head>
    <base href="/">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Qore - Neural Interface - uniQue-ue</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Orbitron:wght@700;800;900&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Global Stylesheet -->
    <link rel="stylesheet" href="style.css">
    
    <!-- D3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <!-- Marked.js for Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- Pyodide for Python -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>
    
    <link rel="icon" href="uniQ_logo_sm2T.png" type="image/png">
    
    <style>
        .qore-layout {
            display: grid;
            grid-template-columns: 250px 1fr 350px;
            height: calc(100vh - 5rem);
            gap: 1rem;
            padding: 1rem;
        }
        
        .sidebar {
            background: linear-gradient(145deg, rgba(16, 20, 44, 0.95), rgba(2, 4, 24, 0.9));
            border: 1px solid rgba(0, 246, 255, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            overflow-y: auto;
        }
        
        .main-view {
            background: linear-gradient(145deg, rgba(16, 20, 44, 0.8), rgba(2, 4, 24, 0.7));
            border: 1px solid rgba(0, 246, 255, 0.2);
            border-radius: 1rem;
            position: relative;
            overflow: hidden;
        }
        
        .chat-panel {
            background: linear-gradient(145deg, rgba(16, 20, 44, 0.95), rgba(2, 4, 24, 0.9));
            border: 1px solid rgba(0, 246, 255, 0.2);
            border-radius: 1rem;
            display: flex;
            flex-direction: column;
        }
        
        .view-container {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        #graph-container {
            width: 100%;
            height: 100%;
        }
        
        .neuro-bar {
            height: 8px;
            background: linear-gradient(90deg, var(--brand-accent), var(--brand-magenta));
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(2, 4, 24, 0.9);
            backdrop-filter: blur(5px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: linear-gradient(145deg, rgba(16, 20, 44, 0.98), rgba(2, 4, 24, 0.95));
            border: 2px solid var(--brand-accent);
            border-radius: 1rem;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .view-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
            text-align: center;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        #chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }
        
        #chat-input-container {
            padding: 1rem;
            border-top: 1px solid rgba(0, 246, 255, 0.2);
        }
        
        #idea-canvas {
            width: 100%;
            height: 100%;
            cursor: crosshair;
        }
        
        #journal-editor, #journal-preview {
            width: 100%;
            height: 50%;
            padding: 1rem;
            overflow-y: auto;
        }
        
        #journal-editor {
            background: rgba(2, 4, 24, 0.5);
            border: none;
            color: var(--brand-text);
            font-family: 'Inter', monospace;
            resize: none;
            border-bottom: 1px solid rgba(0, 246, 255, 0.2);
        }
        
        #python-terminal {
            position: absolute;
            bottom: 1rem;
            left: 1rem;
            right: 1rem;
            background: rgba(2, 4, 24, 0.95);
            border: 1px solid var(--brand-accent);
            border-radius: 0.5rem;
            padding: 1rem;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
        }
        
        #terminal-output {
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            color: #0f0;
            white-space: pre-wrap;
        }
        
        /* Chat Input Styling */
        #chat-input {
            background: #0f172a;
            color: #ffffff;
            font-size: 14px;
            border: 2px solid rgba(0, 246, 255, 0.3);
            padding: 12px 16px;
        }

        #chat-input:focus {
            border-color: #00f6ff;
            box-shadow: 0 0 0 3px rgba(0, 246, 255, 0.1);
            outline: none;
        }

        #chat-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }
        
        /* Message Bubble Styling */
        .message-bubble.user {
            background: linear-gradient(135deg, #0ea5e9, #06b6d4);
            color: #ffffff;
            font-weight: 500;
            border: none;
        }

        .message-bubble.model {
            background: rgba(15, 23, 42, 0.95);
            color: #e2e8f0;
            border: 1px solid rgba(0, 246, 255, 0.3);
        }

        .message-bubble {
            padding: 14px 18px;
            line-height: 1.6;
            font-size: 14px;
        }
        
        @media (max-width: 1024px) {
            .qore-layout {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto;
            }
            
            .sidebar, .chat-panel {
                height: auto;
                max-height: 300px;
            }
        }
    </style>
</head>

<body>
    <!-- Fixed background particle canvas -->
    <canvas id="particle-canvas" class="particle-canvas"></canvas>
    
    <!-- Page Wrapper -->
    <div class="page-wrapper">
        
        <!-- Global Header Component -->
        <div id="header-placeholder">
            <div class="fixed top-0 left-0 right-0 z-50 h-20 bg-brand-secondary/50 backdrop-blur-md animate-pulse"></div>
        </div>
        
        <!-- Main Content -->
        <main class="flex-grow">
            <div class="qore-layout">
                
                <!-- Left Sidebar: Controls & Stats -->
                <div class="sidebar">
                    <h2 class="text-xl font-display font-bold text-brand-accent mb-4">
                        <i class="fas fa-brain mr-2"></i> The Qore
                    </h2>
                    
                    <!-- View Controls -->
                    <div class="mb-6">
                        <h3 class="text-sm font-bold text-brand-text-muted mb-2">Views</h3>
                        <div class="space-y-2">
                            <div class="view-btn bg-brand-accent text-brand-primary" data-view="GRAPH">
                                <i class="fas fa-project-diagram mr-2"></i> Graph
                            </div>
                            <div class="view-btn bg-brand-secondary text-brand-text-muted" data-view="STORYBOARD">
                                <i class="fas fa-film mr-2"></i> Storyboard
                            </div>
                            <div class="view-btn bg-brand-secondary text-brand-text-muted" data-view="IDEAROOM">
                                <i class="fas fa-palette mr-2"></i> Idea Room
                            </div>
                            <div class="view-btn bg-brand-secondary text-brand-text-muted" data-view="JOURNAL">
                                <i class="fas fa-book mr-2"></i> Journal
                            </div>
                        </div>
                    </div>
                    
                    <!-- Neurochemistry Monitor -->
                    <div class="mb-6">
                        <h3 class="text-sm font-bold text-brand-text-muted mb-2">Neurochemistry</h3>
                        <div class="space-y-2">
                            <div>
                                <div class="text-xs text-brand-text-muted mb-1">Dopamine</div>
                                <div class="bg-brand-primary rounded-full overflow-hidden">
                                    <div id="dopamine-bar" class="neuro-bar" style="width: 50%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="text-xs text-brand-text-muted mb-1">Serotonin</div>
                                <div class="bg-brand-primary rounded-full overflow-hidden">
                                    <div id="serotonin-bar" class="neuro-bar" style="width: 50%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="text-xs text-brand-text-muted mb-1">Acetylcholine</div>
                                <div class="bg-brand-primary rounded-full overflow-hidden">
                                    <div id="acetylcholine-bar" class="neuro-bar" style="width: 50%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="text-xs text-brand-text-muted mb-1">Norepinephrine</div>
                                <div class="bg-brand-primary rounded-full overflow-hidden">
                                    <div id="norepinephrine-bar" class="neuro-bar" style="width: 50%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- System Status -->
                    <div>
                        <h3 class="text-sm font-bold text-brand-text-muted mb-2">System</h3>
                        <div class="space-y-1 text-xs">
                            <div id="sync-indicator" class="text-brand-text-muted">‚è≥ Syncing...</div>
                            <div id="python-status" class="text-brand-text-muted">Python: Loading...</div>
                            <div id="midi-status" class="text-brand-text-muted">MIDI: Checking...</div>
                        </div>
                    </div>
                </div>
                
                <!-- Main View Area -->
                <div class="main-view">
                    
                    <!-- Graph View -->
                    <div id="graph-view" class="view-container">
                        <div id="graph-container"></div>
                    </div>
                    
                    <!-- Storyboard View -->
                    <div id="storyboard-view" class="view-container hidden">
                        <div class="p-6 h-full overflow-y-auto">
                            <h2 class="text-2xl font-display font-bold text-brand-accent mb-4">Storyboard</h2>
                            <div id="storyboard-scenes" class="space-y-4 mb-4"></div>
                            <button onclick="addScene()" class="px-4 py-2 bg-brand-accent text-brand-primary rounded-lg hover:bg-brand-accent-hover">
                                <i class="fas fa-plus mr-2"></i> Add Scene
                            </button>
                        </div>
                    </div>
                    
                    <!-- Idea Room View -->
                    <div id="idearoom-view" class="view-container hidden">
                        <div class="p-4 h-full flex flex-col">
                            <div class="flex items-center gap-4 mb-4">
                                <h2 class="text-2xl font-display font-bold text-brand-accent">Idea Room</h2>
                                <input type="color" id="canvas-color" value="#00F6FF" class="w-10 h-10 cursor-pointer">
                                <button onclick="clearCanvas()" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 text-sm">
                                    Clear
                                </button>
                            </div>
                            <canvas id="idea-canvas" class="flex-1 bg-brand-primary rounded-lg border border-brand-accent/20"></canvas>
                        </div>
                    </div>
                    
                    <!-- Journal View -->
                    <div id="journal-view" class="view-container hidden">
                        <div class="h-full flex flex-col">
                            <div class="px-6 py-4 border-b border-brand-accent/20">
                                <h2 class="text-2xl font-display font-bold text-brand-accent">Journal</h2>
                            </div>
                            <textarea id="journal-editor" placeholder="Write your thoughts... (Markdown supported)"></textarea>
                            <div id="journal-preview" class="text-brand-text"></div>
                        </div>
                    </div>
                    
                    <!-- Python Terminal Overlay -->
                    <div id="python-terminal" class="hidden">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-brand-accent font-bold text-sm">Python Output</span>
                            <button onclick="document.getElementById('python-terminal').classList.add('hidden')" class="text-brand-text-muted hover:text-brand-accent">
                                ‚úï
                            </button>
                        </div>
                        <pre id="terminal-output"></pre>
                    </div>
                </div>
                
                <!-- Right Chat Panel -->
                <div class="chat-panel">
                    <div class="p-4 border-b border-brand-accent/20">
                        <h3 class="font-display font-bold text-brand-accent">
                            <i class="fas fa-comments mr-2"></i> Cognitive Interface
                        </h3>
                    </div>
                    
                    <!-- Error/Status Banner -->
                    <div id="chat-status-banner" class="hidden px-4 py-2 bg-red-900/50 border-b border-red-500/50 text-red-200 text-xs">
                        <span id="chat-status-message"></span>
                    </div>
                    
                    <div id="chat-messages" class="flex-1 overflow-y-auto p-4"></div>
                    
                    <div id="chat-input-container">
                        <textarea 
                            id="chat-input" 
                            placeholder="Think out loud... (Try /py or /midi for commands)"
                            class="w-full px-4 py-2 bg-brand-primary border border-brand-accent/30 rounded-lg text-brand-text resize-none focus:outline-none focus:border-brand-accent"
                            rows="3"
                        ></textarea>
                        <button 
                            id="send-message"
                            class="mt-2 w-full px-4 py-2 bg-brand-accent text-brand-primary rounded-lg font-bold hover:bg-brand-accent-hover transition-all"
                        >
                            Send <i class="fas fa-paper-plane ml-2"></i>
                        </button>
                    </div>
                </div>
                
            </div>
        </main>
        
        <!-- Node Inspector Modal -->
        <div id="node-inspector" class="modal-overlay hidden">
            <div class="modal-content">
                <div class="flex justify-between items-start mb-4">
                    <h2 class="text-2xl font-display font-bold text-brand-accent">Node Inspector</h2>
                    <button onclick="window.closeNodeInspector()" class="text-brand-text-muted hover:text-brand-accent text-2xl">
                        ‚úï
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="text-sm text-brand-text-muted">Label</label>
                        <div id="node-label" class="text-lg font-bold text-brand-text"></div>
                    </div>
                    
                    <div>
                        <label class="text-sm text-brand-text-muted">Type</label>
                        <div id="node-type" class="text-brand-accent"></div>
                    </div>
                    
                    <div>
                        <label class="text-sm text-brand-text-muted">Content</label>
                        <div id="node-content" class="text-brand-text"></div>
                    </div>
                    
                    <div>
                        <label class="text-sm text-brand-text-muted">Tags</label>
                        <div id="node-tags" class="text-brand-text-muted text-sm"></div>
                    </div>
                    
                    <div class="flex gap-2 pt-4 border-t border-brand-accent/20">
                        <button 
                            onclick="window.analyzeNodePotential()" 
                            class="flex-1 px-4 py-2 bg-brand-accent text-brand-primary rounded-lg hover:bg-brand-accent-hover font-bold"
                        >
                            üîÆ Analyze Potential
                        </button>
                        <button 
                            onclick="window.dreamProtocol()" 
                            class="flex-1 px-4 py-2 bg-brand-magenta text-white rounded-lg hover:opacity-80 font-bold"
                        >
                            üí≠ Dream Protocol
                        </button>
                    </div>
                    
                    <button 
                        onclick="window.deleteNode()" 
                        class="w-full px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 font-bold"
                    >
                        üóëÔ∏è Delete Node
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Global Footer Component -->
        <div id="footer-placeholder">
            <div class="h-32 w-full bg-brand-primary border-t border-brand-accent/10 animate-pulse"></div>
        </div>
        
    </div>
    
    <!-- Firebase & App Logic -->
    <script src="firebase-config.js" type="module"></script>
    <script src="app.js" type="module"></script>
    
    <!-- The Qore Core -->
    <script type="module">
        import { initialize } from './qore-core.js';
        
        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', async () => {
            await initialize();
        });
        
        // Helper functions for UI
        window.addScene = async function() {
            const description = prompt('Scene description:');
            if (!description) return;
            
            const { state, saveBrainState } = await import('./qore-core.js');
            state.scenes.push({
                description,
                dialogue: '',
                timestamp: Date.now()
            });
            
            saveBrainState();
            
            // Re-render
            const { switchView } = await import('./qore-core.js');
            switchView('STORYBOARD');
        };
        
        window.deleteScene = async function(index) {
            if (!confirm('Delete this scene?')) return;
            
            const { state, saveBrainState } = await import('./qore-core.js');
            state.scenes.splice(index, 1);
            saveBrainState();
            
            // Re-render
            const { switchView } = await import('./qore-core.js');
            switchView('STORYBOARD');
        };
        
        window.clearCanvas = function() {
            const canvas = document.getElementById('idea-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        };
    </script>
</body>
</html>
