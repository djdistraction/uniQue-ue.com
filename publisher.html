<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uniQue-ue - Publisher</title>
    <link rel="icon" href="uniQ_logo_sm2T.png" type="image/png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter & Orbitron -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Orbitron:wght@700;800;900&display=swap" rel="stylesheet">

    <!-- Quill Rich Text Editor CSS -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    
    <!-- Custom Tailwind Config & CSS -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Orbitron', 'sans-serif'],
                    },
                    colors: {
                        'brand-primary': '#020418',
                        'brand-secondary': '#10142C',
                        'brand-accent': '#00F6FF',
                        'brand-accent-hover': '#9EFFFD',
                        'brand-magenta': '#F000B8',
                        'brand-text': '#E5E7EB',
                        'brand-text-muted': '#9CA3AF',
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.8s ease-out forwards',
                        'glow': 'glow 3s ease-in-out infinite alternate',
                    },
                    keyframes: {
                         fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        glow: {
                            'from': { textShadow: '0 0 5px #00F6FF, 0 0 10px #00F6FF', boxShadow: '0 0 10px -5px #00F6FF' },
                            'to': { textShadow: '0 0 10px #00F6FF, 0 0 20px #00F6FF', boxShadow: '0 0 20px -5px #00F6FF' },
                        },
                    }
                }
            }
        }
    </script>
    <style>
        .particle-container {
            position: relative;
            overflow: hidden;
        }
        .particle-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        .content-z {
             position: relative;
             z-index: 3;
        }
        .heading-glow {
             text-shadow: 0 0 3px rgba(0, 246, 255, 0.7), 0 0 5px rgba(0, 246, 255, 0.5);
        }
        /* Quill Editor Styling */
        .ql-toolbar {
            border-top-left-radius: 0.5rem;
            border-top-right-radius: 0.5rem;
            background-color: #10142C;
            border-color: rgba(0, 246, 255, 0.3) !important;
        }
        .ql-container {
            border-bottom-left-radius: 0.5rem;
            border-bottom-right-radius: 0.5rem;
            background-color: #020418;
            border-color: rgba(0, 246, 255, 0.3) !important;
            color: #E5E7EB;
            font-family: 'Inter', sans-serif;
            min-height: 400px;
        }
        .ql-editor {
            font-size: 16px;
        }
        .ql-snow .ql-stroke {
            stroke: rgba(0, 246, 255, 0.8);
        }
        .ql-snow .ql-picker-label {
            color: rgba(0, 246, 255, 0.8);
        }
    </style>
</head>
<body class="bg-brand-primary text-brand-text font-sans antialiased">

    <header id="header" class="fixed top-0 left-0 right-0 z-50 transition-all duration-300">
         <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="index.html">
                <img src="uniQ_logo_T.png" alt="uniQue-ue Logo" class="h-10 w-auto transition-all duration-300 hover:opacity-80">
            </a>
            <nav class="hidden lg:flex items-center space-x-4 font-display text-xs">
                <div class="relative group">
                    <button class="text-brand-accent font-bold transition inline-flex items-center focus:outline-none">
                        Businesses & Products
                        <svg class="ml-1 h-4 w-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                    </button>
                    <div class="absolute left-0 mt-2 w-48 rounded-md shadow-lg bg-brand-secondary/95 backdrop-blur-sm border border-brand-accent/30 hidden group-hover:block z-50 animate-fade-in-up" style="animation-duration: 0.3s;">
                        <div class="py-1">
                            <a href="publisher.html" class="block px-4 py-2 text-sm text-brand-accent font-bold bg-brand-primary">Publisher</a>
                        </div>
                    </div>
                </div>
                <a href="about.html" class="text-brand-text-muted hover:text-brand-accent transition">About Us</a>
                <a href="events.html" class="text-brand-text-muted hover:text-brand-accent transition">Events</a>
                <a href="blog.html" class="text-brand-text-muted hover:text-brand-accent transition">Blog</a>
                <a href="downloads.html" class="text-brand-text-muted hover:text-brand-accent transition">Downloads</a>
                <a href="careers.html" class="text-brand-text-muted hover:text-brand-accent transition">Careers</a>
                <a href="investors.html" class="text-brand-text-muted hover:text-brand-accent transition">Investor Relations</a>
                <a href="chimera-tower.html" class="text-brand-text-muted hover:text-brand-accent transition">Headquarters</a>
            </nav>
            <a href="index.html#contact" class="hidden lg:inline-block bg-brand-accent/80 hover:bg-brand-accent text-brand-primary font-bold px-5 py-2 rounded-md transition border border-brand-accent">
                Initiate Contact
            </a>
            <button id="mobile-menu-button" class="lg:hidden text-white">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
            </button>
        </div>
        <div id="mobile-menu" class="hidden lg:hidden bg-brand-secondary/95 backdrop-blur-sm">
            <div>
                <a href="#" class="block py-3 px-6 text-brand-accent font-bold font-display">Businesses & Products</a>
                <a href="publisher.html" class="block pt-1 pb-3 pl-10 pr-6 text-brand-accent font-bold bg-brand-primary font-display text-xs">Publisher</a>
            </div>
            <a href="about.html" class="block py-3 px-6 text-brand-text-muted hover:bg-brand-primary hover:text-brand-accent font-display">About Us</a>
            <a href="events.html" class="block py-3 px-6 text-brand-text-muted hover:bg-brand-primary hover:text-brand-accent font-display">Events</a>
            <a href="blog.html" class="block py-3 px-6 text-brand-text-muted hover:bg-brand-primary hover:text-brand-accent font-display">Blog</a>
            <a href="downloads.html" class="block py-3 px-6 text-brand-text-muted hover:bg-brand-primary hover:text-brand-accent font-display">Downloads</a>
            <a href="careers.html" class="block py-3 px-6 text-brand-text-muted hover:bg-brand-primary hover:text-brand-accent font-display">Careers</a>
            <a href="investors.html" class="block py-3 px-6 text-brand-text-muted hover:bg-brand-primary hover:text-brand-accent font-display">Investor Relations</a>
            <a href="chimera-tower.html" class="block py-3 px-6 text-brand-text-muted hover:bg-brand-primary hover:text-brand-accent font-display">Headquarters</a>
            <a href="index.html#contact" class="block py-3 px-6 text-brand-text-muted hover:bg-brand-primary hover:text-brand-accent font-display">Initiate Contact</a>
        </div>
    </header>

    <main class="pt-24">
        <section class="py-16 md:py-24 particle-container bg-brand-secondary/50">
            <canvas class="particle-canvas"></canvas>
            <div class="container mx-auto px-6 text-center content-z animate-fade-in-up">
                <h1 class="text-5xl md:text-7xl font-display font-extrabold leading-tight mb-4 heading-glow">The Publisher</h1>
                <p class="text-lg md:text-xl text-brand-text-muted max-w-3xl mx-auto font-sans">
                   Your creative co-pilot. Transform raw ideas into polished, monetizable works through guided questions and optional AI enhancement.
                </p>
            </div>
        </section>

        <section class="py-12 md:py-16 particle-container">
            <canvas class="particle-canvas"></canvas>
            <div class="container mx-auto px-6 content-z">
                <div class="grid lg:grid-cols-3 gap-8">
                    <!-- Column 1: Question Interface -->
                    <div class="lg:col-span-1 bg-brand-secondary/80 p-6 rounded-lg border border-brand-accent/20 animate-fade-in-up" style="animation-delay: 0.2s;">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-2xl font-display font-bold text-brand-accent heading-glow">Phase 1: Dialogue</h2>
                            <button id="upgrade-button" class="text-xs bg-brand-magenta/80 text-white px-3 py-1 rounded-md hover:bg-brand-magenta transition border border-brand-magenta/50 font-bold">Upgrade to AI</button>
                        </div>
                        <div id="chat-container" class="h-96 overflow-y-auto bg-brand-primary/50 p-4 rounded-md mb-4 flex flex-col space-y-4">
                            <!-- Welcome Message -->
                            <div class="p-3 rounded-lg bg-brand-accent/10 max-w-xs text-sm">
                                <p class="font-bold text-brand-accent">Publisher Guide</p>
                                <p class="text-brand-text-muted" id="welcome-message">Welcome to Publisher. I'll ask you a series of questions to help shape your creation. Let's begin!</p>
                            </div>
                            <!-- Questions and answers will appear here -->
                        </div>
                        <div class="flex">
                            <input type="text" id="chat-input" class="flex-grow bg-brand-primary p-3 rounded-l-md border border-brand-accent/30 focus:border-brand-accent focus:ring-brand-accent focus:outline-none transition font-sans" placeholder="Type your answer...">
                            <button id="send-button" class="bg-brand-accent text-brand-primary font-bold px-4 py-3 rounded-r-md transition hover:bg-brand-accent-hover border border-brand-accent">Send</button>
                        </div>
                    </div>

                    <!-- Column 2 & 3: Editor and Publishing -->
                    <div class="lg:col-span-2 space-y-8">
                         <!-- Generation Controls -->
                        <div class="bg-brand-secondary/80 p-6 rounded-lg border border-brand-accent/20 animate-fade-in-up" style="animation-delay: 0.4s;">
                            <h2 class="text-2xl font-display font-bold mb-4 text-brand-accent heading-glow">Phase 2: Manifestation</h2>
                             <p class="text-brand-text-muted mb-4 text-sm">When you are ready, select a format to generate the first draft based on our conversation.</p>
                            <div id="generation-controls" class="flex flex-wrap gap-4">
                                <button data-format="Blog Post" class="gen-button bg-brand-accent/20 text-brand-accent px-4 py-2 rounded-md hover:bg-brand-accent hover:text-brand-primary transition border border-brand-accent/50">Blog Post</button>
                                <button data-format="Article" class="gen-button bg-brand-accent/20 text-brand-accent px-4 py-2 rounded-md hover:bg-brand-accent hover:text-brand-primary transition border border-brand-accent/50">Article</button>
                                <button data-format="Short Story" class="gen-button bg-brand-accent/20 text-brand-accent px-4 py-2 rounded-md hover:bg-brand-accent hover:text-brand-primary transition border border-brand-accent/50">Short Story</button>
                                <button data-format="Novel Outline" class="gen-button bg-brand-accent/20 text-brand-accent px-4 py-2 rounded-md hover:bg-brand-accent hover:text-brand-primary transition border border-brand-accent/50">Novel Outline</button>
                                <button data-format="Comic Script" class="gen-button bg-brand-accent/20 text-brand-accent px-4 py-2 rounded-md hover:bg-brand-accent hover:text-brand-primary transition border border-brand-accent/50">Comic Script</button>
                            </div>
                        </div>

                        <!-- Document Editor -->
                        <div class="bg-brand-secondary/80 p-6 rounded-lg border border-brand-accent/20 animate-fade-in-up" style="animation-delay: 0.6s;">
                            <h2 class="text-2xl font-display font-bold mb-4 text-brand-accent heading-glow">Phase 3: Refinement</h2>
                            <div id="editor-container"></div>
                        </div>
                        
                        <!-- Publishing -->
                        <div class="bg-brand-secondary/80 p-6 rounded-lg border border-brand-accent/20 animate-fade-in-up" style="animation-delay: 0.8s;">
                            <h2 class="text-2xl font-display font-bold mb-4 text-brand-accent heading-glow">Phase 4: Monetization</h2>
                            <p class="text-brand-text-muted mb-4 text-sm">Once your work is perfected, let's discuss publishing strategies, monetization channels, and affiliate integrations to bring your creation to the global market.</p>
                            <button id="publish-button" class="bg-brand-magenta/80 text-white px-6 py-3 rounded-md hover:bg-brand-magenta transition border border-brand-magenta/50 font-bold">Initiate Publishing Protocol</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-brand-primary py-8 border-t border-brand-secondary/50">
        <div class="container mx-auto px-6 text-center text-brand-text-muted font-sans text-sm">
            <p>&copy; <span id="copyright-year">2025</span> uniQue-ue. All Rights Reserved.</p>
            <p>A uniQue-ue.com Cyberspace Relay</p>
        </div>
    </footer>

    <!-- Quill Rich Text Editor JS -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- Header & Menu Logic ---
            const header = document.getElementById('header');
            window.addEventListener('scroll', () => {
                if (window.scrollY > 50) {
                    header.classList.add('bg-brand-secondary/95', 'backdrop-blur-sm', 'shadow-lg', 'border-b', 'border-brand-accent/30');
                } else {
                    header.classList.remove('bg-brand-secondary/95', 'backdrop-blur-sm', 'shadow-lg', 'border-b', 'border-brand-accent/30');
                }
            });
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });

            // --- Particle Background ---
            const Particle = class {
                constructor(x, y, size, speedX, speedY, color) { this.x = x; this.y = y; this.size = size; this.speedX = speedX; this.speedY = speedY; this.color = color; }
                update(canvas) { if (this.x < 0 || this.x > canvas.width) this.speedX *= -1; if (this.y < 0 || this.y > canvas.height) this.speedY *= -1; this.x += this.speedX; this.y += this.speedY; }
                draw(ctx) { ctx.fillStyle = this.color; ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill(); }
            };
            const setupParticleCanvas = (canvas) => {
                const ctx = canvas.getContext('2d'); let particles = []; const parent = canvas.parentElement;
                const resizeCanvas = () => { canvas.width = parent.clientWidth; canvas.height = parent.clientHeight; initParticles(); };
                const initParticles = () => {
                    const area = canvas.width * canvas.height; const particleCount = Math.max(15, Math.floor(area / 25000)); particles = [];
                    for (let i = 0; i < particleCount; i++) {
                        const size = Math.random() * 1.5 + 0.5; const x = Math.random() * canvas.width; const y = Math.random() * canvas.height;
                        const speedX = (Math.random() * 0.4) - 0.2; const speedY = (Math.random() * 0.4) - 0.2;
                        const color = `rgba(0, 246, 255, ${Math.random() * 0.6 + 0.3})`;
                        particles.push(new Particle(x, y, size, speedX, speedY, color));
                    }
                };
                const animateParticles = () => { ctx.clearRect(0, 0, canvas.width, canvas.height); for (const particle of particles) { particle.update(canvas); particle.draw(ctx); } requestAnimationFrame(animateParticles); };
                const resizeObserver = new ResizeObserver(() => resizeCanvas()); resizeObserver.observe(parent);
                animateParticles();
            };
            document.querySelectorAll('.particle-canvas').forEach(setupParticleCanvas);

            // --- Quill Editor Initialization ---
            const quill = new Quill('#editor-container', {
                theme: 'snow',
                placeholder: 'Generated content will appear here after manifestation...',
                modules: {
                    toolbar: [
                        [{ 'header': [1, 2, 3, false] }],
                        ['bold', 'italic', 'underline', 'strike'],
                        [{'list': 'ordered'}, {'list': 'bullet'}],
                        ['link', 'image'],
                        ['clean']
                    ]
                }
            });

            // --- Publisher Logic with Free/Paid Tiers ---
            const chatContainer = document.getElementById('chat-container');
            const chatInput = document.getElementById('chat-input');
            const sendButton = document.getElementById('send-button');
            const upgradeButton = document.getElementById('upgrade-button');
            const genButtons = document.querySelectorAll('.gen-button');
            
            // State management
            let isPaidTier = localStorage.getItem('publisherPaidTier') === 'true';
            let userApiKey = localStorage.getItem('publisherApiKey') || '';
            let currentQuestionIndex = 0;
            let userAnswers = {};
            let chatHistory = [];

            // Predetermined questions for free tier
            const predeterminedQuestions = [
                "What type of content would you like to create? (e.g., blog post, article, story, etc.)",
                "What is the main topic or theme you want to explore?",
                "Who is your target audience?",
                "What key message or takeaway do you want readers to have?",
                "What tone would you like? (e.g., formal, casual, inspirational, educational)",
                "Are there any specific points or sections you want to include?",
                "What length are you aiming for? (e.g., short, medium, long)",
                "Do you have a title in mind, or should one be suggested?"
            ];

            // Update UI based on tier
            function updateTierUI() {
                const welcomeMsg = document.getElementById('welcome-message');
                if (isPaidTier && userApiKey) {
                    welcomeMsg.textContent = 'AI Mode Active! I am here to listen and help you explore your thoughts. What story is waiting to be told?';
                    upgradeButton.textContent = 'AI Active ✓';
                    upgradeButton.disabled = true;
                    upgradeButton.classList.add('opacity-50', 'cursor-not-allowed');
                } else {
                    welcomeMsg.textContent = 'Welcome to Publisher. I\'ll ask you a series of questions to help shape your creation. Let\'s begin!';
                    upgradeButton.textContent = 'Upgrade to AI';
                    upgradeButton.disabled = false;
                    upgradeButton.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            }

            const addMessage = (sender, message, questionId = null) => {
                const messageDiv = document.createElement('div');
                const senderClass = sender === 'user' ? 'bg-brand-secondary self-end' : 'bg-brand-accent/10 self-start';
                const senderName = sender === 'user' ? 'You' : (isPaidTier && userApiKey ? 'AI Muse' : 'Publisher Guide');
                const senderColor = sender === 'user' ? 'text-brand-text-muted' : 'text-brand-accent';

                messageDiv.className = `p-3 rounded-lg ${senderClass} max-w-xs text-sm`;
                messageDiv.innerHTML = `<p class="font-bold ${senderColor}">${senderName}</p><p class="text-brand-text-muted">${message}</p>`;
                if (questionId !== null) {
                    messageDiv.dataset.questionId = questionId;
                }
                chatContainer.appendChild(messageDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            };

            // Free tier: Question-based flow
            const askNextQuestion = () => {
                if (currentQuestionIndex < predeterminedQuestions.length) {
                    const question = predeterminedQuestions[currentQuestionIndex];
                    addMessage('guide', question, currentQuestionIndex);
                    currentQuestionIndex++;
                } else {
                    addMessage('guide', 'Great! I have all the information I need. You can now select a format to generate your content.');
                }
            };

            // AI tier: Free-form conversation
            const handleAiChat = async (userMessage) => {
                chatHistory.push({ role: 'user', parts: [{ text: userMessage }] });
                
                const thinkingDiv = document.createElement('div');
                thinkingDiv.className = 'p-3 rounded-lg bg-brand-accent/10 max-w-xs text-sm';
                thinkingDiv.innerHTML = `<p class="font-bold text-brand-accent">AI Muse</p><p class="text-brand-text-muted animate-pulse">Thinking...</p>`;
                chatContainer.appendChild(thinkingDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
                
                const systemPrompt = "You are an AI Muse, a creative partner. Your goal is to help users explore their ideas for writing projects. Be patient, encouraging, and conversational. Ask open-ended questions. Never rush the user. Your purpose is to facilitate a dialogue that helps them flesh out their thoughts. Do not generate stories or articles in the chat. Your role is to be a thoughtful sounding board until they are ready to generate content.";
                const functionUrl = '/.netlify/functions/getAiResponse';

                try {
                    const headers = { 'Content-Type': 'application/json' };
                    if (userApiKey) {
                        headers['X-User-API-Key'] = userApiKey;
                    }
                    
                    const response = await fetch(functionUrl, {
                        method: 'POST',
                        headers: headers,
                        body: JSON.stringify({ chatHistory, systemPrompt })
                    });
                    
                    chatContainer.removeChild(thinkingDiv);

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || `Server error: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    const aiMessage = result.candidates[0].content.parts[0].text;
                    
                    addMessage('ai', aiMessage);
                    chatHistory.push({ role: 'model', parts: [{ text: aiMessage }] });

                } catch (error) {
                    console.error("Error communicating with AI function:", error);
                    addMessage('ai', 'My apologies, I am having trouble connecting to the network. Please try again or check your API key.');
                }
            };

            const handleSend = async () => {
                const userMessage = chatInput.value.trim();
                if (!userMessage) return;

                addMessage('user', userMessage);
                chatInput.value = '';

                if (isPaidTier && userApiKey) {
                    // AI mode
                    await handleAiChat(userMessage);
                } else {
                    // Free tier: Save answer and ask next question
                    if (currentQuestionIndex > 0) {
                        userAnswers[`q${currentQuestionIndex - 1}`] = userMessage;
                    }
                    setTimeout(askNextQuestion, 500);
                }
            };
            
            const handleGenerate = async (format) => {
                let contentPrompt = '';
                
                if (isPaidTier && userApiKey) {
                    // AI mode: Use chat history
                    if (chatHistory.length < 2) {
                        quill.setText('Please have a short conversation with the AI first to establish your ideas.');
                        return;
                    }
                    
                    quill.setText(`Generating ${format}... Please wait...`);
                    const functionUrl = '/.netlify/functions/getAiResponse';
                    const generationSystemPrompt = `You are a content generation AI. Based on the provided conversation history, generate a complete and well-structured ${format}.`;
                    
                    const generationChatHistory = [{
                        role: 'user',
                        parts: [{ text: `Please generate a ${format} based on this conversation: ${JSON.stringify(chatHistory)}` }]
                    }];

                    try {
                        const headers = { 'Content-Type': 'application/json' };
                        if (userApiKey) {
                            headers['X-User-API-Key'] = userApiKey;
                        }
                        
                        const response = await fetch(functionUrl, {
                            method: 'POST',
                            headers: headers,
                            body: JSON.stringify({ chatHistory: generationChatHistory, systemPrompt: generationSystemPrompt })
                        });

                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.error || `Server error: ${response.status}`);
                        }

                        const result = await response.json();
                        const generatedContent = result.candidates[0].content.parts[0].text;

                        quill.setText(generatedContent);

                    } catch (error) {
                        console.error("Error generating content:", error);
                        quill.setText(`Error: Could not generate content. Please check your API key and try again.`);
                    }
                } else {
                    // Free tier: Use question answers to create structured content
                    if (Object.keys(userAnswers).length < 3) {
                        quill.setText('Please answer at least 3 questions before generating content.');
                        return;
                    }
                    
                    quill.setText(`Generating ${format} based on your answers...`);
                    
                    // Build content from structured answers
                    setTimeout(() => {
                        let content = `# ${format}\n\n`;
                        content += `**Based on your responses:**\n\n`;
                        
                        predeterminedQuestions.forEach((question, idx) => {
                            if (userAnswers[`q${idx}`]) {
                                content += `**${question}**\n${userAnswers[`q${idx}`]}\n\n`;
                            }
                        });
                        
                        content += `\n---\n\n`;
                        content += `*This is a structured outline based on your answers. Upgrade to the AI tier to generate fully-formed content with creative enhancement.*`;
                        
                        quill.setText(content);
                    }, 1000);
                }
            };

            // Upgrade modal handling
            upgradeButton.addEventListener('click', () => {
                showUpgradeModal();
            });

            function showUpgradeModal() {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black/80 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-brand-secondary p-8 rounded-lg max-w-md border border-brand-accent/30 relative">
                        <button class="absolute top-4 right-4 text-brand-text-muted hover:text-brand-accent" onclick="this.closest('.fixed').remove()">✕</button>
                        <h2 class="text-2xl font-display font-bold mb-4 text-brand-accent">Upgrade to AI Mode</h2>
                        <p class="text-brand-text-muted mb-4">Unlock the full power of AI-assisted content creation with intelligent conversations that adapt to your creative process.</p>
                        
                        <div class="bg-brand-primary/50 p-4 rounded-md mb-4">
                            <h3 class="font-bold text-brand-accent mb-2">What you get:</h3>
                            <ul class="text-sm text-brand-text-muted space-y-1">
                                <li>✓ Natural AI conversations</li>
                                <li>✓ Adaptive creative dialogue</li>
                                <li>✓ Advanced content generation</li>
                                <li>✓ Use your own API key (no recurring fees)</li>
                            </ul>
                        </div>
                        
                        <p class="text-xs text-brand-text-muted mb-4">Payment: $9.99 one-time activation fee</p>
                        
                        <div class="space-y-3">
                            <button onclick="handlePayment()" class="w-full bg-brand-magenta text-white px-6 py-3 rounded-md hover:bg-brand-magenta/80 transition font-bold">
                                Proceed to Payment
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="w-full bg-brand-secondary border border-brand-accent/30 text-brand-text-muted px-6 py-3 rounded-md hover:border-brand-accent transition">
                                Maybe Later
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }

            window.handlePayment = function() {
                // Close upgrade modal
                document.querySelectorAll('.fixed').forEach(m => m.remove());
                
                // Show payment simulation (in production, this would integrate with a real payment processor)
                const paymentModal = document.createElement('div');
                paymentModal.className = 'fixed inset-0 bg-black/80 flex items-center justify-center z-50';
                paymentModal.innerHTML = `
                    <div class="bg-brand-secondary p-8 rounded-lg max-w-md border border-brand-accent/30">
                        <h2 class="text-2xl font-display font-bold mb-4 text-brand-accent">Payment Simulation</h2>
                        <p class="text-brand-text-muted mb-4">In a production environment, this would integrate with Stripe, PayPal, or another payment processor.</p>
                        <p class="text-sm text-brand-text-muted mb-6">For demo purposes, click below to simulate a successful payment.</p>
                        <button onclick="completeActivation()" class="w-full bg-brand-accent text-brand-primary px-6 py-3 rounded-md hover:bg-brand-accent-hover transition font-bold">
                            Simulate Payment Success
                        </button>
                    </div>
                `;
                document.body.appendChild(paymentModal);
            };

            window.completeActivation = function() {
                // Close payment modal
                document.querySelectorAll('.fixed').forEach(m => m.remove());
                
                // Show API key input
                const apiKeyModal = document.createElement('div');
                apiKeyModal.className = 'fixed inset-0 bg-black/80 flex items-center justify-center z-50';
                apiKeyModal.innerHTML = `
                    <div class="bg-brand-secondary p-8 rounded-lg max-w-md border border-brand-accent/30">
                        <h2 class="text-2xl font-display font-bold mb-4 text-brand-accent">Setup Your API Key</h2>
                        <p class="text-brand-text-muted mb-4">To use AI features, you'll need to provide your own Google Gemini API key. This keeps your costs transparent and under your control.</p>
                        
                        <div class="bg-brand-primary/50 p-4 rounded-md mb-4">
                            <p class="text-xs text-brand-text-muted mb-2">Get your free API key:</p>
                            <a href="https://makersuite.google.com/app/apikey" target="_blank" class="text-brand-accent text-sm hover:underline">https://makersuite.google.com/app/apikey</a>
                        </div>
                        
                        <input type="text" id="api-key-input" placeholder="Paste your API key here..." class="w-full bg-brand-primary p-3 rounded-md border border-brand-accent/30 focus:border-brand-accent focus:outline-none mb-4">
                        
                        <div class="space-y-2">
                            <button onclick="saveApiKey()" class="w-full bg-brand-accent text-brand-primary px-6 py-3 rounded-md hover:bg-brand-accent-hover transition font-bold">
                                Activate AI Mode
                            </button>
                            <p class="text-xs text-brand-text-muted text-center">You can change this later in settings</p>
                        </div>
                    </div>
                `;
                document.body.appendChild(apiKeyModal);
            };

            window.saveApiKey = function() {
                const apiKey = document.getElementById('api-key-input').value.trim();
                if (!apiKey) {
                    alert('Please enter a valid API key');
                    return;
                }
                
                // Save to localStorage
                localStorage.setItem('publisherPaidTier', 'true');
                localStorage.setItem('publisherApiKey', apiKey);
                isPaidTier = true;
                userApiKey = apiKey;
                
                // Close modal
                document.querySelectorAll('.fixed').forEach(m => m.remove());
                
                // Reset chat
                chatContainer.innerHTML = '';
                chatHistory = [];
                currentQuestionIndex = 0;
                userAnswers = {};
                
                // Update UI
                updateTierUI();
                
                // Show welcome message
                const welcomeDiv = document.createElement('div');
                welcomeDiv.className = 'p-3 rounded-lg bg-brand-accent/10 max-w-xs text-sm';
                welcomeDiv.innerHTML = `<p class="font-bold text-brand-accent">AI Muse</p><p class="text-brand-text-muted">Welcome. I am here to listen. Let's explore your thoughts. What story is waiting to be told?</p>`;
                chatContainer.appendChild(welcomeDiv);
            };

            sendButton.addEventListener('click', handleSend);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleSend();
            });

            genButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const format = button.dataset.format;
                    handleGenerate(format);
                });
            });

            // Initialize
            updateTierUI();
            if (!isPaidTier) {
                // Start with first question in free tier
                setTimeout(askNextQuestion, 1000);
            }

            // --- Dynamic Copyright Year ---
            document.getElementById('copyright-year').textContent = new Date().getFullYear();
        });
    </script>
</body>
</html>




